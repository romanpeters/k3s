{
  "extends": ["config:recommended"],
  "timezone": "Europe/Amsterdam",
  "labels": ["dependencies", "renovate"],
  "enabledManagers": ["kubernetes", "flux", "helm-values", "github-actions"],
  "prConcurrentLimit": 20,
  "prHourlyLimit": 0,
  "platformAutomerge": true,
  "separateMajorMinor": false,
  "separateMinorPatch": false,
  "dependencyDashboard": false,
  "kubernetes": {
    "managerFilePatterns": [
      "/apps/.+\\.ya?ml$/",
      "/clusters/.+\\.ya?ml$/",
      "/infrastructure/.+\\.ya?ml$/"
    ]
  },
  "packageRules": [
    {
      "description": "If latest is used, pin digest so the image becomes immutable until replaced with a version tag",
      "matchDatasources": ["docker"],
      "matchCurrentValue": "/^latest$/",
      "pinDigests": true,
      "groupName": "pin floating latest docker tags"
    },
    {
      "description": "Always hold major updates for manual review",
      "matchDatasources": ["docker", "github-actions"],
      "matchUpdateTypes": ["major"],
      "automerge": false,
      "labels": ["dependencies", "renovate", "major-update", "manual-review"]
    },
    {
      "description": "Auto-merge non-major updates for selected app paths after CI checks pass",
      "matchDatasources": ["docker"],
      "matchUpdateTypes": ["minor", "patch", "digest"],
      "matchFileNames": [
        "apps/general/**",
        "apps/media/**",
        "apps/infrastructure/**",
        "apps/monitoring/**",
        "apps/automation/**"
      ],
      "automerge": true,
      "automergeType": "pr",
      "groupName": "selected apps docker non-major updates"
    }
  ]
}
